<!DOCTYPE html>
<html lang="en">

<head>
  <script id="dpal" src="//www.redhat.com/ma/dpal.js" type="text/javascript"></script>
  <meta charset="utf-8">
  <title>WorkFlows Definitions</title>

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="this is meta description">

  

  <!-- ** Plugins Needed for the Project ** -->
  
  <link rel="stylesheet" href="/assets/plugins/bootstrap/bootstrap.min.css">
  
  <link rel="stylesheet" href="/assets/plugins/themify-icons/themify-icons.css">
  
  <link rel="stylesheet" href="/assets/plugins/slick/slick.css">
  

  <link href="/assets/scss/syntax_monokai.css" rel="stylesheet">
  <!-- Main Stylesheet -->
  <link href="/assets/scss/style.css" rel="stylesheet">

  <!--Favicon-->
  <link rel="shortcut icon" href="/assets/images/favicon.png " type="image/x-icon">
  <link rel="icon" href="/assets/images/flotta-logo-stacked.ico " type="image/x-icon">

  <!-- google analytics -->
  

</head>


<body>

  <header class="navigation fixed-top nav-bg">
  <nav class="navbar navbar-expand-lg navbar-dark">
    <a class="navbar-brand font-tertiary h3" href="/">
      
        <img src="/assets/images/parodos-logo-horizontal-darkbg.png" alt="Parodos" style="height: 60px;">
        
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navigation"
      aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse text-center" id="navigation">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item active">
          <a class="nav-link" href="/">Home</a>
        </li>
        
          <li class="nav-item ">
            <a class="nav-link" href="/blog.html">Blog</a>
          </li>
        
          <li class="nav-item ">
            <a class="nav-link" href="/documentation/latest/intro/overview.html">Documentation</a>
          </li>
        
      </ul>
    </div>
  </nav>
</header>


  <section class="section skip_top">
  <div class="container">
    <div class="row">
      <div class="col-lg-4">
        
        
        <ul class="list-group list-group-collapse border-0">
          
          <li class="list-group-item border-0">
            <h5>
              
              Intro
              
            </h5>
            
            <ul class="list-group border-0">
              
              
              <li class="list-group-item border-0"> <a href="/documentation/latest/intro/overview.html">What is Parados</a> </li>
              
              
              <li class="list-group-item border-0"> <a href="/documentation/latest/intro/usecases.html">Use cases</a> </li>
              
              
              <li class="list-group-item border-0"> <a href="/documentation/latest/intro/vs.html">Parados vs others</a> </li>
              
              
              <li class="list-group-item border-0"> <a href="/documentation/latest/intro/concepts.html">Parados Concepts</a> </li>
              
            </ul>
            
          </li>
          
          <li class="list-group-item border-0">
            <h5>
              
              Getting started
              
            </h5>
            
            <ul class="list-group border-0">
              
              
              <li class="list-group-item border-0"> <a href="/documentation/latest/gsg/kind.html">Kind</a> </li>
              
              
              <li class="list-group-item border-0"> <a href="/documentation/latest/gsg/ocp.html">Openshift</a> </li>
              
              
              <li class="list-group-item border-0"> <a href="/documentation/latest/gsg/running_workflows.html">Running WorkFlows</a> </li>
              
            </ul>
            
          </li>
          
          <li class="list-group-item border-0">
            <h5>
              
              Operations
              
            </h5>
            
            <ul class="list-group border-0">
              
              
              <li class="list-group-item border-0"> <a href="/documentation/latest/operations/requirements.html">System Requirements</a> </li>
              
              
              <li class="list-group-item border-0"> <a href="/documentation/latest/operations/workflows.html">WorkFlow Definitions</a> </li>
              
              
              <li class="list-group-item border-0"> <a href="/documentation/latest/operations/deployment_options.html">Deployment options</a> </li>
              
              
              <li class="list-group-item border-0"> <a href="/documentation/latest/operations/configuration.html">Configuration</a> </li>
              
              
              <li class="list-group-item border-0"> <a href="/documentation/latest/operations/observability.html">Observability</a> </li>
              
              
              <li class="list-group-item border-0"> <a href="/documentation/latest/operations/troubleshooting.html">Troubleshooting</a> </li>
              
              
              <li class="list-group-item border-0"> <a href="/documentation/latest/operations/api.html">API reference</a> </li>
              
              
              <li class="list-group-item border-0"> <a href="/documentation/latest/operations/prebuilt.html">Prebuilt WorkFlow tasks</a> </li>
              
            </ul>
            
          </li>
          
          <li class="list-group-item border-0">
            <h5>
              
              For developers
              
            </h5>
            
            <ul class="list-group border-0">
              
              
              <li class="list-group-item border-0"> <a href="/documentation/latest/dev/installation.html">Manual installation & tips</a> </li>
              
              
              <li class="list-group-item border-0"> <a href="/documentation/latest/dev/guide.html">Development Guide</a> </li>
              
            </ul>
            
          </li>
          
        </ul>
        <p>Documentation for version: <b>latest</b></p>
        <ul class="list-group list-group-collapse border-0">
          <li class="list-group-item border-0">
            <h5>Other versions</h5>

            <ul class="list-group border-0">
              
              
              
              
              <li class="list-group-item border-0"> <a href="/documentation/latest/intro/overview.html"> latest</a> </li>
              
            </ul>
          </li>

        </ul>
      </div>

      <div class="col-lg-8">
        <div class="documentation content">
          
          <!-- Some cases we don't want to show the title -->
          <h1 class="font-tertiary mb-5">WorkFlows Definitions</h1>
          
          

          <p>A workflow is defined by a Java Bean, and it registered to the database on
startup time. A Workflow needs to implement the WorkFlow interface, so it can
be used by the workflow-service, the workflow-interface can be found
<a href="https://github.com/parodos-dev/parodos/blob/main/workflow-engine/src/main/java/com/redhat/parodos/workflows/workflow/WorkFlow.java">here</a>
.</p>

<h4 id="types-of-work">Types of Work</h4>

<ul>
  <li>workflow-task:  an atomic unit of work. It should be single purposed and focus
on a particular domain task. The main
logic of a WorkflowFlowTask is configured in the <code class="language-plaintext highlighter-rouge">execute</code> method.</li>
  <li>workflow: a set of workflow-tasks or workflows. It constructs a domain area or
a logic aggregation of tasks.</li>
</ul>

<h4 id="processing-types-of-workflow">Processing Types of Workflow</h4>

<p>There are two processing types of workflow:</p>

<ul>
  <li>Parallel workflow:  works inside this workflow will run simultaneously</li>
  <li>Sequential workflow: works inside this workflow will be executed sequentially,
one after the other.</li>
</ul>

<h4 id="types-of-workflow">Types of Workflow</h4>

<ul>
  <li>Infrastructure workflow: this type of workflow is to execute the tasks related
to the business logic of the domain.</li>
  <li>Assessment workflow: this is the workflow to process some evaluation and
provide some options for executing
Infrastructure workflows.</li>
  <li>checker workflow: a workflow that is scheduled regularly to check the status
of a
workflow-task <a href="#workflow-checker">click to see details</a></li>
</ul>

<p>A workflow example can be found in the workflow-examples directory inside the
<a href="https://github.com/parodos-dev/parodos">Git  repository</a>. An example workflow,
workflow-task can be find in the following diagram:</p>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/9.0.1/mermaid.min.js"></script>
<div class="mermaid">

    flowchart TB
    direction LR
    classDef dot fill:#fff,stroke:#000,stroke-width:1px;
classDef task fill:#2374f7,stroke:#000,stroke-width:2px,color:#fff
classDef checker fill:#fc822b,stroke:#000,stroke-width:2px,color:#fff


    User(Create User)
    class User task;

    subgraph "Openshift"[Openshift WorkFlow]
    Oinit(( )):::myCircleNode;
        direction LR
        addSA(Add Service Account)
        addRBACPolicies(Add Rbac for user)
        class addSA,addRBACPolicies task;
        Oinit --&gt;addSA;
        addSA --&gt; addRBACPolicies;
        addRBACPolicies --&gt;Ofinish;
        Ofinish(( )):::myCircleNode;

    end

    subgraph "Vault"[Vault WorkFlow]
    Vinit(( )):::myCircleNode;

        addUser(Add User to Vault)
        addToAws(Add User to aws project)
        class addUser,addToAws task;
        Vfinish(( )):::myCircleNode;

        Vinit --&gt;addUser;
        Vinit --&gt;addToAws;
        addUser --&gt;Vfinish;
        addToAws --&gt;Vfinish;

    end

    User --&gt;  Openshift
    User --&gt; Vault

    checker(( )):::myCircleNode;

    Ofinish --&gt; checker
    Vfinish --&gt; checker
    checker --&gt; Send(Email to user)

</div>

<p>The example workflow above has three child sequentially works:</p>

<ol>
  <li>workflow-task <em>Create User</em></li>
  <li>Parallel workflow of two child workflows: <strong>Openshift WorkFlow</strong>
and <strong>Vault WorkFlow</strong>.
    <ul>
      <li>Openshift WorkFlow is a sequential workflow that consists of two
workflow-tasks: <em>Add Service Account</em> and <em>Add Rbac for user</em>.</li>
      <li>Vault WorkFlow is a parallel workflow comprises <em>Add User to Vault</em> and
<em>Add User to aws project</em> workflow-tasks.</li>
    </ul>
  </li>
  <li>workflow-task <em>Email to user</em>.</li>
</ol>

<h2 id="concepts-and-components-of-workflow">Concepts and Components of Workflow</h2>

<h3 id="how-to-compose-workflows">How to compose workflows</h3>

<p>Details of steps to write workflows can be found in <a href="https://github.com/parodos-dev/parodos/blob/main/workflow-examples/README.md">workflow-example
README</a> . A
typical workflow configuration module will have a configuration class for
defining workflow and multiple classes for defining workflow-tasks. Parodos
workflow server will detect and load the workflow/tasks by bean registration
when bootstrapping.</p>

<h2 id="workflow-configuration">Workflow Configuration</h2>

<p>Workflows are configured in a class with the <strong><em>@Configuration</em></strong>, annotation.
It is expected there will be at least one <strong><em>@Bean</em></strong> method returning a
Workflow reference. Usually one configuration class should only contain one
main workflow and all of its child works.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="o">....</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleWorkFlowConfiguration</span> <span class="o">{</span>
    <span class="o">....</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="register-workflow-bean">Register Workflow Bean</h3>

<p>In this sample below, one workflow with its task can be seen:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    <span class="nd">@Bean</span>
    <span class="nc">RestAPIWorkFlowTask</span> <span class="nf">restCall</span><span class="o">(){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">RestAPIWorkFlowTask</span><span class="o">();</span>
    <span class="o">}</span>


    <span class="nd">@Bean</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"simpleSequentialWorkFlow"</span> <span class="o">+</span> <span class="nc">WorkFlowConstants</span><span class="o">.</span><span class="na">INFRASTRUCTURE_WORKFLOW</span><span class="o">)</span>
    <span class="nd">@Infrastructure</span>
    <span class="nc">WorkFlow</span> <span class="nf">simpleSequentialWorkFlowTask</span><span class="o">(</span><span class="nd">@Qualifier</span><span class="o">(</span><span class="s">"restCall"</span><span class="o">)</span> <span class="nc">RestAPIWorkFlowTask</span> <span class="n">restCall</span><span class="o">,</span><span class="nc">LoggingWorkFlowTask</span> <span class="n">loggingTask</span><span class="o">){</span>
        <span class="k">return</span> <span class="nc">SequentialFlow</span>
            <span class="o">.</span><span class="na">Builder</span><span class="o">.</span><span class="na">aNewSequentialFlow</span><span class="o">().</span><span class="na">named</span><span class="o">(</span><span class="s">"simple Sequential Infrastructure WorkFlow"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">restCall</span><span class="o">)</span>
            <span class="o">.</span><span class="na">then</span><span class="o">(</span><span class="n">loggingTask</span><span class="o">)</span>
            <span class="o">.</span><span class="na">build</span><span class="o">();</span>
        <span class="o">}</span>


</code></pre></div></div>

<p>For the Workflow, the second argument(loggingTask) is not defined in a <em>@Bean</em>
method. This is because that WorkflowTask has the <em>@Component</em> annotation and
can be created by Spring’s bean factory using the default constructor. In
contrast, <em>RestAPIWorkFlowTask</em>o needs a value supplied in the constructor to
be created. As a result it is created in a method using the <em>@Bean</em> annotation.
It’s best practise to create a unique name for this Bean as there might be
multiple version of Bean of this type created. In that example the default name
is used (method name) to identify the Bean.</p>

<p>The workflow example above is annotated with <strong><em>@Infrastructure.</em></strong> This is the
most common type of workflows that run executions of its tasks. It runs to
complete and stops if any tasks fail. The Other two types of
<strong><em>workflow(@Assessment</em></strong> and <strong><em>@Checker</em></strong> will be explained in sections
below)</p>

<h3 id="workflow-properties">Workflow properties</h3>

<p>When registering a workflow, only the bean annotation is needed, but at the
moment some workflow-properties can be added. These properties are metadata
base content that may is useful for the end users to append in the workflow. To
register metadata, the following example can be used:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">import</span> <span class="nn">com.redhat.parodos.workflow.annotation.WorkFlowProperties</span><span class="o">;</span>

<span class="o">....</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleWorkFlowConfiguration</span> <span class="o">{</span>
    
    <span class="o">....</span>

    <span class="nd">@Bean</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"simpleSequentialWorkFlow"</span> <span class="o">+</span> <span class="nc">WorkFlowConstants</span><span class="o">.</span><span class="na">INFRASTRUCTURE_WORKFLOW</span><span class="o">)</span>
    <span class="nd">@WorkFlowProperties</span><span class="o">(</span><span class="n">version</span> <span class="o">=</span> <span class="s">"${git.commit.id}"</span><span class="o">)</span>
    <span class="nc">WorkFlow</span> <span class="nf">simpleSequentialWorkFlowTask</span><span class="o">(</span><span class="nd">@Qualifier</span><span class="o">(</span><span class="s">"restCallTask"</span><span class="o">)</span> <span class="nc">RestAPIWorkFlowTask</span> <span class="n">restCallTask</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">SequentialFlow</span>
                <span class="o">.</span><span class="na">Builder</span><span class="o">.</span><span class="na">aNewSequentialFlow</span><span class="o">()</span>
                <span class="o">.</span><span class="na">named</span><span class="o">(</span><span class="s">"simpleSequentialWorkFlow"</span> <span class="o">+</span> <span class="nc">WorkFlowConstants</span><span class="o">.</span><span class="na">INFRASTRUCTURE_WORKFLOW</span><span class="o">)</span>
                <span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">restCallTask</span><span class="o">)</span>
                <span class="o">.</span><span class="na">then</span><span class="o">(</span><span class="n">loggingTask</span><span class="o">)</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>
    
    <span class="o">....</span>
<span class="o">}</span>
</code></pre></div></div>

<p>In this case, we’re using
<a href="https://dzone.com/articles/maven-git-commit-id-plugin">maven-git-plugin</a> to
inject the git commit id inside the WorkFlow configuration, the properties can
be retrieved on the workflow definition API endpoint, as an example:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nt">--</span><span class="o">&gt;</span> curl <span class="nv">$AUTH</span> <span class="se">\</span>
    <span class="s2">"http://localhost:8080/api/v1/workflowdefinitions/b1ef2356-37bb-45e9-99cd-1e97a13a1ac9"</span> | <span class="se">\</span>
    jq .properties <span class="nt">-r</span>
<span class="o">{</span>
  <span class="s2">"version"</span>: <span class="s2">"</span><span class="se">\"</span><span class="s2">a673364e13c4dfe8e1d357991ff284d2419ca41c</span><span class="se">\"</span><span class="s2">,"</span>
<span class="o">}</span>
</code></pre></div></div>

<p>At the moment, the list of properties are the following:</p>

<table class="table">
  <thead>
    <tr>
      <th>Property Nane</th>
      <th>Kind</th>
      <th>Default Value</th>
      <th>Comment</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>version</td>
      <td>String</td>
      <td>””</td>
      <td>A way to append a version to the workFlow</td>
    </tr>
  </tbody>
</table>

<h3 id="workflow-parameters">Workflow parameters</h3>

<p>Each Work can accept parameters, these parameters is what the end user will
use to give some information to the workflow. Workflow Administrator is the one
that define in each Workflow the parameters needed.</p>

<p>Each parameter can be defined inside the Java Bean, and an example can be the
following one:</p>

<p>example of workflow parameter:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ComplexWorkFlowConfiguration</span> <span class="o">{</span>
    
    <span class="o">....</span>

    <span class="nd">@Infrastructure</span><span class="o">(</span><span class="n">parameters</span> <span class="o">=</span> <span class="o">{</span>
            <span class="nd">@Parameter</span><span class="o">(</span><span class="n">key</span> <span class="o">=</span> <span class="s">"workloadId"</span><span class="o">,</span> <span class="n">description</span> <span class="o">=</span> <span class="s">"The workload id"</span><span class="o">,</span> <span class="n">type</span> <span class="o">=</span> <span class="nc">WorkParameterType</span><span class="o">.</span><span class="na">TEXT</span><span class="o">,</span>
                    <span class="n">optional</span> <span class="o">=</span> <span class="kc">false</span><span class="o">),</span>
            <span class="nd">@Parameter</span><span class="o">(</span><span class="n">key</span> <span class="o">=</span> <span class="s">"projectUrl"</span><span class="o">,</span> <span class="n">description</span> <span class="o">=</span> <span class="s">"The project url"</span><span class="o">,</span> <span class="n">type</span> <span class="o">=</span> <span class="nc">WorkParameterType</span><span class="o">.</span><span class="na">URL</span><span class="o">,</span>
                    <span class="n">optional</span> <span class="o">=</span> <span class="kc">true</span><span class="o">),</span>
            <span class="nd">@Parameter</span><span class="o">(</span><span class="n">key</span> <span class="o">=</span> <span class="s">"WORKFLOW_SELECT_SAMPLE"</span><span class="o">,</span> <span class="n">description</span> <span class="o">=</span> <span class="s">"Workflow select parameter sample"</span><span class="o">,</span>
                    <span class="n">type</span> <span class="o">=</span> <span class="nc">WorkParameterType</span><span class="o">.</span><span class="na">SELECT</span><span class="o">,</span> <span class="n">optional</span> <span class="o">=</span> <span class="kc">true</span><span class="o">,</span> <span class="n">selectOptions</span> <span class="o">=</span> <span class="o">{</span><span class="s">"option1"</span><span class="o">,</span> <span class="s">"option2"</span><span class="o">},</span>
                    <span class="n">valueProviderName</span> <span class="o">=</span> <span class="s">"complexWorkFlowValueProvider"</span><span class="o">)})</span>
    <span class="nc">WorkFlow</span> <span class="nf">complexWorkFlow</span><span class="o">(</span><span class="nd">@Qualifier</span><span class="o">(</span><span class="s">"subWorkFlowThree"</span><span class="o">)</span> <span class="nc">WorkFlow</span> <span class="n">subWorkFlowThree</span><span class="o">,</span>
                             <span class="nd">@Qualifier</span><span class="o">(</span><span class="s">"subWorkFlowFour"</span><span class="o">)</span> <span class="nc">WorkFlow</span> <span class="n">subWorkFlowFour</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">SequentialFlow</span><span class="o">.</span><span class="na">Builder</span><span class="o">.</span><span class="na">aNewSequentialFlow</span><span class="o">().</span><span class="na">named</span><span class="o">(</span><span class="s">"complexWorkFlow"</span><span class="o">).</span><span class="na">execute</span><span class="o">(</span><span class="n">subWorkFlowThree</span><span class="o">)</span>
                <span class="o">.</span><span class="na">then</span><span class="o">(</span><span class="n">subWorkFlowFour</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>
    
    <span class="o">....</span>

<span class="o">}</span>

</code></pre></div></div>

<p>So, each WorkParameter has a key name, with some description and some values.
If WorkFlow Administrator wants to add some custom validation can extend the
Parameter with the JsonSchemaOptions, that it will append the value to the
parameter at the frontend.</p>

<p>The list of parameters can be find
<a href="https://github.com/parodos-dev/parodos/blob//parodos-model-api/src/main/java/com/redhat/parodos/workflow/parameter/WorkParameterType.java">here</a>
,
and the parameters are the following:</p>

<table>
  <thead>
    <tr>
      <th>Parameter Name</th>
      <th>Type</th>
      <th>JsonSchem options</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>PASSWORD</td>
      <td>text</td>
      <td>{ “type”: “string”, “format”: “password” }</td>
    </tr>
    <tr>
      <td>TEXT</td>
      <td>text</td>
      <td>{ “type”: “string” }</td>
    </tr>
    <tr>
      <td>EMAIL</td>
      <td>text</td>
      <td>{ “type”: “string”, “format”: “email” }</td>
    </tr>
    <tr>
      <td>DATE</td>
      <td>text</td>
      <td>{ “type”: “string”, “format”: “date” }</td>
    </tr>
    <tr>
      <td>NUMBER</td>
      <td>text</td>
      <td>{ “type”: “number” }</td>
    </tr>
    <tr>
      <td>URL</td>
      <td>text</td>
      <td>{ “type”: “string”, “format”: “url” }</td>
    </tr>
    <tr>
      <td>SELECT</td>
      <td>select</td>
      <td>{ “type”: “string”, “enum”: [] }</td>
    </tr>
    <tr>
      <td>MULTI_SELECT</td>
      <td>multi-select</td>
      <td>{ “type”: “array”, “items”: { “type”: “string”, “enum”: [] } }</td>
    </tr>
  </tbody>
</table>

<h3 class="table" id="workflow-options">Workflow options</h3>

<p>In the configuration section, a Workflow created as an Assessment will need to
return WorkflowOption.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    <span class="nd">@Bean</span>
    <span class="nc">WorkFlowOption</span> <span class="nf">onboardingOption</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nc">WorkFlowOption</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="s">"onboardingOption"</span><span class="o">,</span>
                <span class="s">"onboardingWorkFlow"</span><span class="o">+</span><span class="nc">WorkFlowConstants</span><span class="o">.</span><span class="na">INFRASTRUCTURE_WORKFLOW</span><span class="o">)</span>
                <span class="o">.</span><span class="na">addToDetails</span><span class="o">(</span><span class="s">"An example of a complex WorkFlow with Status checks"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">displayName</span><span class="o">(</span><span class="s">"Onboarding"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">setDescription</span><span class="o">(</span><span class="s">"An example of a complex WorkFlow"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="nc">OnboardingAssessmentTask</span> <span class="nf">onboardingAssessmentTask</span><span class="o">(</span>
    <span class="nd">@Qualifier</span><span class="o">(</span><span class="s">"onboardingOption"</span><span class="o">)</span> <span class="nc">WorkFlowOption</span> <span class="n">awesomeToolsOption</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">OnboardingAssessmentTask</span><span class="o">(</span><span class="n">awesomeToolsOption</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"onboardingAssessment"</span> <span class="o">+</span> <span class="nc">WorkFlowConstants</span><span class="o">.</span><span class="na">ASSESSMENT_WORKFLOW</span><span class="o">)</span>
    <span class="nd">@Assessment</span>
    <span class="nc">WorkFlow</span> <span class="nf">assessmentWorkFlow</span><span class="o">(</span>
    <span class="nd">@Qualifier</span><span class="o">(</span><span class="s">"onboardingAssessmentTask"</span><span class="o">)</span> <span class="nc">OnboardingAssessmentTask</span> <span class="n">onboardingAssessmentTask</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">SequentialFlow</span><span class="o">.</span><span class="na">Builder</span><span class="o">.</span><span class="na">aNewSequentialFlow</span><span class="o">().</span><span class="na">named</span><span class="o">(</span><span class="s">"onboarding     Assessment WorkFlow"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">onboardingAssessmentTask</span><span class="o">)</span>
            <span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>

</code></pre></div></div>

<p>The WorkflowOption references a specific <strong><em>@Infrastructure</em></strong> Workflow bean
definition defined in the same file as <code class="language-plaintext highlighter-rouge">"onboardingWorkFlow" +
WorkFlowConstants.INFRASTRUCTURE_WORKFLOW</code>.</p>

<h2 id="workflow-task-configuration">Workflow Task Configuration</h2>

<h3 id="execution-implementation">Execution implementation</h3>

<p>The main logic of a WorkflowFlowTask is configured in the <code class="language-plaintext highlighter-rouge">execute</code> method. As
can be seen in the following example</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    <span class="kd">public</span> <span class="nc">WorkReport</span> <span class="nf">execute</span><span class="o">(</span><span class="nc">WorkContext</span> <span class="n">workContext</span><span class="o">){</span>
        <span class="k">try</span><span class="o">{</span>
            <span class="o">....</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">DefaultWorkReport</span><span class="o">(</span><span class="nc">WorkStatus</span><span class="o">.</span><span class="na">COMPLETED</span><span class="o">,</span><span class="n">workContext</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
            <span class="o">....</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">DefaultWorkReport</span><span class="o">(</span><span class="nc">WorkStatus</span><span class="o">.</span><span class="na">FAILED</span><span class="o">,</span><span class="n">workContext</span><span class="o">);</span>
    <span class="o">}</span>

</code></pre></div></div>

<p>The execute section does the ‘work’ required by the task. It also needs to
return a <em>WorkReport</em> indicating the <em>WorkStatus</em> (ie: COMPLETED, FAILED). In the
case of a Sequential Workflow, the workflow will stop executing if the returned
WorkReport has a WorkStatus of <em>FAILED.</em></p>

<h3 id="workflowtask-parameters">WorkflowTask Parameters</h3>

<p>WorkflowTask Parameter has the same properties as
<a href="#workflow-parameters">Workflow Parameter</a>.
The only difference is that WorkflowTask Parameters are defined
in the method <code class="language-plaintext highlighter-rouge">getWorkFlowTaskParameters</code> in each Task class</p>

<p>An example of workflow-task parameter is written like this:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoggingWorkFlowTask</span> <span class="kd">extends</span> <span class="nc">BaseInfrastructureWorkFlowTask</span> <span class="o">{</span>
    <span class="o">....</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">WorkReport</span> <span class="nf">execute</span><span class="o">(</span><span class="nc">WorkContext</span> <span class="n">workContext</span><span class="o">)</span> <span class="o">{</span>
        <span class="o">...</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">WorkParameter</span><span class="o">&gt;</span> <span class="nf">getWorkFlowTaskParameters</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">List</span><span class="o">.</span><span class="na">of</span><span class="o">(</span>
                <span class="nc">WorkParameter</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">key</span><span class="o">(</span><span class="s">"api-server"</span><span class="o">).</span><span class="na">description</span><span class="o">(</span><span class="s">"The api server"</span><span class="o">).</span><span class="na">type</span><span class="o">(</span><span class="nc">WorkParameterType</span><span class="o">.</span><span class="na">URL</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">optional</span><span class="o">(</span><span class="kc">false</span><span class="o">).</span><span class="na">build</span><span class="o">(),</span>
                <span class="nc">WorkParameter</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                        <span class="o">.</span><span class="na">key</span><span class="o">(</span><span class="s">"user-id"</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">description</span><span class="o">(</span><span class="s">"The user id"</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">type</span><span class="o">(</span><span class="nc">WorkParameterType</span><span class="o">.</span><span class="na">TEXT</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">optional</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">jsonSchemaOptions</span><span class="o">(</span><span class="nc">Map</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"minLength"</span><span class="o">,</span> <span class="s">"1"</span><span class="o">,</span> <span class="s">"maxLength"</span><span class="o">,</span> <span class="s">"64"</span><span class="o">))</span>
                        <span class="o">.</span><span class="na">build</span><span class="o">());</span>
    <span class="o">}</span>

<span class="o">}</span>

</code></pre></div></div>

<h3 id="worktask-outputs">WorkTask Outputs</h3>

<h2 id="workflow-checker">WorkFlow Checker</h2>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/9.0.1/mermaid.min.js"></script>
<div class="mermaid">
flowchart LR
classDef dot fill:#fff,stroke:#000,stroke-width:1px;
classDef task fill:#2374f7,stroke:#000,stroke-width:2px,color:#fff
classDef checker fill:#fc822b,stroke:#000,stroke-width:2px,color:#fff


    jiraTicket[[Create ticket for OCP access]]:::task
    SendEmail[[Send email to the approval]]:::task

    approved{Is ticket approved}:::task
    needEscalated{Needs to escalate}:::checker
    ManagerApproval[[Manager to approve the ticket]]:::task

    SendNotification[[Send notification to user]]:::task

    jiraTicket --&gt;SendEmail;
    SendEmail --&gt;approved;
    approved --&gt;|No|needEscalated;
    approved ---&gt;|Yes|SendNotification

    needEscalated --&gt;|Yes|ManagerApproval;
    ManagerApproval --&gt;approved

</div>

<p>In the diagram above, we can see that some task needs the human’s input. For
this case, Parodos implement a checker solution where it can be used to
escalate a workflow to a specific person if something does not happens in a
defined time constraint.</p>

<p>Folowing that diagram, each blue node is a task, and we can see that the orange
box is checker that can be implemented like the workflow adminsitrator. A
checker can be defined like this:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nd">@Bean</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"namespaceApprovalWorkFlowChecker"</span><span class="o">)</span>
<span class="nd">@Checker</span><span class="o">(</span><span class="n">cronExpression</span> <span class="o">=</span> <span class="s">"*/5 * * * * ?"</span><span class="o">)</span>
    <span class="nc">WorkFlow</span> <span class="nf">namespaceApprovalWorkFlowChecker</span><span class="o">(</span>
<span class="nd">@Qualifier</span><span class="o">(</span><span class="s">"namespaceApprovalWorkFlowCheckerTask"</span><span class="o">)</span> <span class="nc">NamespaceApprovalWorkFlowCheckerTask</span> <span class="n">namespaceApprovalWorkFlowCheckerTask</span><span class="o">){</span>
        <span class="k">return</span> <span class="nc">SequentialFlow</span><span class="o">.</span><span class="na">Builder</span><span class="o">.</span><span class="na">aNewSequentialFlow</span><span class="o">().</span><span class="na">named</span><span class="o">(</span><span class="s">"namespaceApprovalWorkFlowChecker"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">namespaceApprovalWorkFlowCheckerTask</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
        <span class="o">}</span>

</code></pre></div></div>

<p>So, in this case, the checker will execute each five minutes to check if the
work need to be escalate to a higher level. To define an escalation, it’s as
simple to use the <strong><em>@escalation</em></strong> annotation.</p>

<p>Here you can see an example:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nd">@Bean</span>
<span class="nd">@Escalation</span>
<span class="kd">public</span> <span class="nc">WorkFlow</span> <span class="nf">simpleTaskOneEscalatorWorkflow</span><span class="o">(</span>
<span class="nd">@Qualifier</span><span class="o">(</span><span class="s">"simpleTaskOneEscalator"</span><span class="o">)</span> <span class="nc">SimpleTaskOneEscalator</span> <span class="n">simpleTaskOneEscalator</span><span class="o">){</span>
        <span class="k">return</span> <span class="nc">SequentialFlow</span><span class="o">.</span><span class="na">Builder</span>
        <span class="o">.</span><span class="na">aNewSequentialFlow</span><span class="o">()</span>
        <span class="o">.</span><span class="na">named</span><span class="o">(</span><span class="s">"simpleTaskOneEscalatorWorkflow"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">simpleTaskOneEscalator</span><span class="o">)</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
        <span class="o">}</span>

</code></pre></div></div>

        </div>
      </div>
    </div>
  </div>
</section>


  <!-- footer -->
<footer class="bg-dark footer-section">
  <div class="section">
    <div class="container">
      <div class="row">
        <div class="col-md-4">
          <h5 class="text-light">Email</h5>
          <p class="text-white paragraph-lg font-secondary">parodos@redhat.com</p>
        </div>
        <div class="col-md-4">
          <h5><a href="http://www.redhat.com"><img id="sponsorship" class="footerLogo" src="/assets/images/Logo-Red_Hat-Supported_By-A-Reverse-RGB.svg"></a>.</h5>
        </div>
        <!-- <div class="col-md-4"> -->
        <!--   <h5 class="text-light">Address</h5> -->
        <!--   <p class="text-white paragraph-lg font-secondary"></p> -->
        <!-- </div> -->
      </div>
    </div>
  </div>
  <div class="border-top text-center border-dark py-5">
    <p class="mb-0 text-light"><p>Copyright © 2020 Designed by <a href="https://themefisher.com">Themefisher</a> &amp; Developed by <a href="https://getjekyllthemes.com">Getjekyllthemes</a></p>
</p>
  </div>
</footer>
<!-- /footer -->


<!-- JS Plugins -->

<script src="/assets/plugins/jQuery/jquery.min.js"></script>

<script src="/assets/plugins/bootstrap/bootstrap.min.js"></script>

<script src="/assets/plugins/shuffle/shuffle.min.js"></script>

<script src="/assets/plugins/slick/slick.min.js"></script>


<!-- Main Script -->
<script src="/assets/js/script.js"></script>

<!-- This comes from DTM/DPAL and must be latest entry in body-->
<script type="text/javascript">
  if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
      _satellite.pageBottom();
  }
</script>


<script>
  $(function() {
    return $("h2, h3, h4, h5, h6").each(function(i, el) {
      var $el, icon, id;
      $el = $(el);
      id = $el.attr('id');
      icon = '<i class="ti-link"></i>';
      console.log("test test"+id)
      if (id) {
        return $el.prepend($("<a />").addClass("header-link").attr("href", "#" + id).html(icon));
      }
    });
  });
</script>


</body>

</html>
